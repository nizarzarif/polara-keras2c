#include <stdio.h> 
#include <math.h> 
#include "./include/k2c_include.h" 
#include "simplenet.h" 

float maxabs(k2c_tensor* tensor1, k2c_tensor* tensor2);
float test1_input_1_1_input_array[784] = {
-3.31911981e-01f,+8.81297974e-01f,-1.99954250e+00f,-7.90669709e-01f,-1.41297644e+00f,
-1.63064562e+00f,-1.25495915e+00f,-6.17757092e-01f,-4.12930103e-01f,+1.55266936e-01f,
-3.23221942e-01f,+7.40878002e-01f,-1.18219100e+00f,+1.51246975e+00f,-1.89044963e+00f,
+6.81870041e-01f,-3.30780791e-01f,+2.34759314e-01f,-1.43845225e+00f,-1.20759404e+00f,
+1.20297827e+00f,+1.87304630e+00f,-7.46303287e-01f,+7.69290463e-01f,+1.50555661e+00f,
+1.57842665e+00f,-1.65982315e+00f,-1.84378087e+00f,-1.32067832e+00f,+1.51257001e+00f,
-1.60661266e+00f,-3.15569500e-01f,+1.83155812e+00f,+1.32661140e-01f,+7.67508456e-01f,
-7.37937476e-01f,+7.46003711e-01f,+1.33850269e+00f,-1.92684689e+00f,+1.00057726e+00f,
+1.95544436e+00f,+9.92662618e-01f,-8.78224032e-01f,+1.15711731e+00f,-1.58709597e+00f,
-2.08425895e-01f,+1.63438201e+00f,-8.25543407e-01f,-8.48898646e-01f,-1.47988571e+00f,
-1.92253217e+00f,+7.15342132e-01f,-1.15348754e+00f,-9.37813363e-01f,-3.37073629e-02f,
-1.78654982e+00f,+2.96470422e-01f,-1.41308570e+00f,+3.57222148e-01f,+7.99033440e-01f,
-1.59066228e+00f,-3.43776049e-01f,+7.77600631e-01f,-3.43282922e-01f,-1.80018616e+00f,
+1.43585624e-01f,+6.55178581e-01f,+5.95564482e-02f,+1.77837902e+00f,+3.46220162e-01f,
+1.61360766e+00f,-1.45010118e+00f,-1.44289461e+00f,+1.22956515e+00f,-4.09292652e-01f,
-1.33858321e+00f,+1.71003432e+00f,-6.08936561e-01f,+1.00324841e+00f,+9.03991941e-01f,
+1.53322436e+00f,+4.94688828e-01f,+1.00376974e+00f,-6.04406632e-01f,-9.20288433e-01f,
+1.58354487e+00f,-2.87635241e-01f,+1.85936019e+00f,+6.53765991e-01f,+4.86782881e-01f,
-1.54101611e+00f,+1.79795703e+00f,-2.00351466e-01f,+3.13558458e-01f,-3.67452789e-01f,
-1.05189208e+00f,+1.61351808e+00f,+2.94717947e-01f,-1.98851869e+00f,+4.68579654e-01f,
-6.93420393e-01f,+1.08232409e-01f,+1.54376840e+00f,-5.70920960e-01f,+1.63414060e+00f,
+4.93440463e-01f,-1.93671503e+00f,+1.71774893e+00f,+7.63587670e-01f,+1.98929140e+00f,
-1.31063797e+00f,-1.45145700e+00f,+1.73038185e+00f,+7.87272646e-01f,-1.73599931e+00f,
+1.02185221e+00f,+1.01550475e+00f,+1.69209814e+00f,+8.46099035e-01f,-1.50291615e+00f,
-1.92047946e+00f,-1.89515605e+00f,-1.88677405e+00f,-1.01515573e+00f,+1.44011179e+00f,
+1.55324257e-01f,+2.11287915e-01f,+1.36812357e+00f,-1.50330674e+00f,-8.83265284e-01f,
+3.43037086e-01f,+1.87838299e+00f,+2.44120877e-01f,-1.92541084e+00f,+1.20253069e+00f,
-1.06810290e+00f,+1.22842078e+00f,-4.48557424e-01f,+1.45416742e+00f,+9.88486571e-01f,
+2.24960936e-01f,-1.45417910e+00f,-1.76032924e+00f,-1.51462618e+00f,-1.82179249e+00f,
-1.57002348e+00f,-1.09716265e+00f,+8.51955922e-01f,+2.38867928e-01f,-1.94977608e+00f,
-1.71210288e+00f,+1.86910532e+00f,+2.72401848e-01f,-1.18682706e+00f,-9.90697022e-01f,
+9.75303416e-01f,-1.21828208e+00f,+3.25435709e-01f,+1.88007996e+00f,+1.38731521e+00f,
-1.04060896e+00f,-2.49211429e-02f,+4.79822874e-01f,+1.31592360e+00f,-1.37283442e+00f,
-1.92569519e+00f,-1.71991143e+00f,-5.46195563e-02f,+4.25317847e-01f,+2.75405748e-01f,
-7.30550363e-01f,+1.95446462e+00f,+3.18980877e-01f,-4.79435310e-01f,+2.03792876e-01f,
+9.81337724e-01f,+6.76931574e-01f,-9.40321769e-01f,-1.73466066e+00f,-5.19663208e-01f,
+5.18870028e-01f,-1.15930396e+00f,+1.01102221e+00f,-1.73385407e+00f,-9.58739606e-01f,
+1.21901825e+00f,-1.22626287e+00f,+5.57843524e-01f,+9.86812365e-02f,+1.69923188e+00f,
-9.46812918e-01f,-1.73615564e+00f,+9.40263853e-01f,+1.08871212e+00f,+1.63126341e+00f,
+1.72788828e+00f,-1.94419371e+00f,-1.06255166e+00f,+4.67113428e-01f,+1.79606528e+00f,
+1.80070448e+00f,+2.26612753e-01f,+1.66242540e+00f,+5.66264836e-01f,-4.39969143e-01f,
-5.60373316e-02f,+4.17241932e-01f,+1.98191686e-01f,+1.70472571e+00f,+1.67493374e+00f,
-4.20497548e-01f,+1.85305011e+00f,-1.30417733e+00f,-1.49468192e+00f,-1.45968337e+00f,
+2.26486627e-02f,-1.91390078e+00f,+1.79188084e+00f,+1.30846188e+00f,-1.93992408e+00f,
-1.29521498e+00f,-6.71745703e-01f,-1.47601262e+00f,+1.23796277e+00f,-6.21053389e-01f,
+1.76042993e+00f,+3.28056720e-01f,+1.51532794e+00f,+1.37893778e+00f,+1.62156927e+00f,
-1.60478937e-01f,+1.85387264e-01f,+1.19441436e+00f,-8.57124593e-01f,-3.89859095e-02f,
+3.96441231e-01f,-1.93786690e+00f,+3.73925633e-01f,-2.65294604e-01f,+1.22944212e+00f,
-7.39020788e-01f,+1.57155483e+00f,+3.11428861e-01f,-1.26395919e+00f,+1.15171694e+00f,
+4.48124708e-01f,-1.78436291e+00f,-3.19225280e-01f,+7.16275346e-01f,+1.67440711e+00f,
-1.99839190e+00f,+1.90703660e+00f,-4.93678741e-01f,+1.89513415e+00f,+4.18864404e-01f,
+1.31538323e+00f,+2.98846019e-01f,+5.12304793e-01f,-8.57694873e-01f,+3.47333363e-01f,
+1.00008705e+00f,+1.43325535e+00f,+1.02032875e+00f,+7.92228994e-01f,+1.45791772e+00f,
-7.09276013e-01f,+6.83155163e-01f,-1.96504254e-01f,-4.71588992e-01f,-3.56754600e-01f,
-3.94081666e-01f,-7.30464216e-01f,+4.87677472e-01f,-2.79010917e-01f,+1.89520831e+00f,
+7.11203566e-01f,-1.20572045e+00f,-2.93195963e-01f,-6.26615041e-01f,+1.19055522e+00f,
+1.51999315e+00f,+1.61536782e+00f,+6.50879250e-01f,-9.19166952e-01f,-9.90533194e-01f,
+1.41959177e+00f,+1.10858585e-01f,+1.20864434e+00f,+2.89954069e-01f,+9.32570101e-01f,
+7.60465099e-02f,+1.08353564e+00f,+2.75431963e-01f,-1.37160486e-01f,-6.29244368e-01f,
-1.72716261e+00f,-4.88303283e-01f,-1.68149569e+00f,+1.93126845e+00f,-1.27354859e+00f,
+1.24743479e+00f,+1.49984658e+00f,+7.53653010e-01f,+2.77977651e-01f,-1.35611425e+00f,
-1.32479909e-01f,-6.19311795e-01f,-1.09984017e+00f,+3.70047475e-01f,-7.50920649e-01f,
+1.66522221e+00f,+1.63854210e+00f,-9.71526825e-01f,-1.55643480e+00f,-1.22814907e+00f,
-1.66331728e-03f,+9.14342672e-01f,-1.16722225e+00f,-1.00786577e+00f,+1.40668750e+00f,
-3.36605127e-01f,+4.66740269e-01f,-1.06533544e+00f,-1.59213096e+00f,+6.34280679e-02f,
-9.14360518e-02f,-1.38931342e+00f,+4.87224927e-01f,+1.76040475e-01f,+6.16549388e-01f,
-1.42181784e+00f,+1.00611127e+00f,-1.11180344e+00f,+7.74072975e-02f,+1.14118411e+00f,
-1.91067829e+00f,-7.02550161e-01f,+1.49168951e+00f,+1.37883843e+00f,+1.53762370e-01f,
+1.46643310e+00f,+1.79922397e+00f,+1.30562799e+00f,+1.41646178e+00f,-1.60502639e+00f,
+6.05217329e-01f,+8.14067953e-01f,+4.40963251e-01f,+1.19846105e+00f,-1.86171512e+00f,
+1.08095494e+00f,+9.26914403e-01f,-9.61206427e-01f,-9.71722805e-01f,+5.29213270e-01f,
-6.18810154e-01f,+1.18635471e+00f,-2.15415072e-01f,+1.13099766e+00f,+1.96188713e+00f,
-7.99006642e-01f,-1.42797669e+00f,+1.60523375e+00f,+1.66237516e-01f,+1.89896148e+00f,
+5.46417600e-01f,+1.97565210e+00f,+1.84283217e-01f,+1.05703736e-01f,-1.45828839e+00f,
-5.77179316e-01f,-1.89512573e+00f,-1.35841928e+00f,+9.82548771e-01f,-1.87840124e+00f,
-5.33827611e-01f,+1.44938501e+00f,+7.70710870e-01f,+7.63768568e-01f,-1.24545280e+00f,
-2.32382877e-01f,+3.26309629e-01f,+1.95900683e+00f,-1.18437510e+00f,-1.00906839e+00f,
-9.51307665e-01f,+1.00068965e+00f,-1.72098690e-01f,-1.77228225e+00f,+3.40649624e-02f,
-1.15215934e+00f,+1.19441698e+00f,-8.10674474e-01f,-1.88957595e+00f,+3.73729798e-01f,
+1.37536172e+00f,-4.75935504e-01f,+9.99433243e-01f,+4.45659132e-02f,+1.63807220e-01f,
+1.83773728e+00f,+1.21584357e+00f,-1.87070773e+00f,+8.37549005e-01f,-1.39994074e-01f,
+1.79019577e+00f,-1.11426906e+00f,-9.31711921e-01f,-1.67410414e+00f,-2.85524685e-01f,
-1.56392494e+00f,+5.35147042e-01f,+1.21185295e+00f,+7.87201984e-01f,+1.06484552e+00f,
-6.30183521e-01f,+1.38340593e+00f,-2.84924900e-01f,+1.29603948e+00f,+5.05984634e-01f,
-1.42630781e+00f,-1.68645240e+00f,-1.92666943e+00f,-1.73310001e+00f,-1.65664745e-01f,
-1.54663231e+00f,-1.88886660e+00f,+1.01944593e+00f,-4.20598078e-01f,+9.87753982e-01f,
-1.90380693e-01f,-1.99653012e-01f,-8.77099731e-02f,-1.03984294e-01f,+1.21265337e+00f,
-3.90429921e-01f,+1.61874464e+00f,-1.85175581e+00f,+1.09549737e+00f,-1.49743448e+00f,
+4.74054268e-01f,-1.95854295e+00f,+1.54509130e-01f,-1.98792817e+00f,+1.80477514e+00f,
+1.62160813e+00f,+1.18386777e+00f,+1.66109728e+00f,-1.41776708e+00f,-1.36907972e+00f,
-1.24947331e+00f,+4.89983609e-01f,+1.62323798e+00f,+1.95982071e+00f,+8.44489835e-01f,
+9.27201637e-01f,+1.63717282e+00f,-3.96505071e-01f,-1.00059728e+00f,-1.30627932e+00f,
-1.52217180e+00f,+1.25044235e+00f,-1.41283051e+00f,-9.42810069e-01f,+1.27635671e+00f,
-7.57650993e-01f,+1.92966980e+00f,-9.33445191e-01f,+1.34613380e-01f,-7.42131955e-01f,
+1.64309132e+00f,-5.33773425e-01f,-2.65630691e-01f,+4.91707691e-02f,+1.75554591e+00f,
-1.87620397e+00f,+8.67514655e-01f,+1.56407582e+00f,-1.89085111e+00f,+8.82049890e-02f,
-6.96040753e-01f,+1.43795728e+00f,+2.34066204e-01f,+7.60911473e-01f,-1.88586000e-01f,
+5.13236150e-01f,-8.39612593e-01f,-1.96260569e+00f,+3.07023740e-01f,-7.54223143e-01f,
+6.90703940e-02f,+1.66562341e+00f,-2.94100846e-01f,-1.01041585e+00f,-5.14824955e-01f,
+1.72744447e+00f,+1.74747353e+00f,+1.37731979e+00f,+1.68082606e+00f,-1.08839884e+00f,
-1.65007116e+00f,-1.09076105e+00f,-7.42493536e-01f,-1.30093649e+00f,+4.28376648e-01f,
-3.45654340e-01f,+1.26540605e+00f,-1.25947841e+00f,+8.07506119e-01f,-1.03857750e+00f,
+2.96876355e-01f,-6.04049611e-01f,-1.77214240e+00f,-1.08474532e+00f,+6.56410221e-01f,
-1.09996266e-02f,+7.60639363e-02f,-1.30111940e+00f,+2.82863406e-01f,+1.98701370e+00f,
+1.26734044e+00f,+3.77490495e-01f,+1.90395627e+00f,+1.60625034e+00f,+3.82431734e-01f,
-1.87029470e+00f,-1.62569162e+00f,-1.73851314e+00f,-1.93067405e-01f,-4.98260667e-01f,
+1.90140014e+00f,-1.32806683e+00f,+1.89115037e+00f,+1.06989948e+00f,+1.29695136e+00f,
+5.30463267e-01f,+6.74931081e-01f,-9.24706659e-02f,-1.94745457e+00f,-5.87975658e-01f,
-3.17127940e-02f,+9.20364844e-01f,-1.25486629e-01f,-1.70380336e-01f,-1.44934904e+00f,
-1.95644506e+00f,+1.03311304e+00f,-7.20188648e-01f,+1.93753380e+00f,-1.11906310e+00f,
-6.45167898e-01f,+9.55845427e-02f,+1.01956583e+00f,-1.44568864e-01f,-1.50070983e+00f,
-7.49994486e-01f,+1.80766788e-02f,+6.95396032e-01f,+1.08059983e+00f,-1.47865688e+00f,
-1.90833947e+00f,+7.63292888e-02f,+1.23995484e+00f,-1.94958493e+00f,+6.89879379e-01f,
+7.47232907e-01f,-2.03012986e-01f,+1.65915475e+00f,+5.77444339e-01f,-1.97904065e+00f,
-6.22862179e-02f,+1.43727122e+00f,+1.32159828e+00f,+5.96616788e-01f,+6.94793696e-01f,
+3.13998319e-01f,-9.03520899e-01f,+2.42119962e-01f,+6.86919139e-01f,-5.90281479e-01f,
+1.42331347e+00f,-1.21985006e+00f,+9.89283241e-01f,-8.41589015e-01f,+1.09519715e+00f,
-2.89050683e-01f,+1.23079364e+00f,-5.85860549e-01f,-1.14522705e+00f,+1.06913803e+00f,
-7.65432209e-01f,+9.32980271e-01f,+9.77892612e-01f,-1.11441320e+00f,-1.14355145e+00f,
-1.20420831e+00f,-1.42992665e+00f,-4.91669603e-01f,-1.89348846e+00f,-1.55631852e+00f,
+6.98256095e-01f,+1.19910615e+00f,-1.67788189e+00f,-1.07319076e+00f,-1.16949735e+00f,
+1.66933425e+00f,+8.45258073e-01f,+2.15538444e-01f,-7.81928048e-01f,+1.33941619e+00f,
-2.58776169e-01f,+1.69382486e+00f,+8.24207217e-01f,-8.78747681e-02f,-1.49515959e+00f,
+1.90417420e+00f,-1.36066540e+00f,-1.18959150e+00f,-2.75272979e-01f,-3.83192377e-01f,
-1.41299408e+00f,+9.17275677e-01f,-1.24501973e+00f,+5.75582577e-01f,+1.01722380e+00f,
-1.15707043e+00f,+4.03816992e-01f,+9.95713501e-01f,+5.52874842e-01f,+3.88509212e-01f,
-8.18070857e-01f,+9.26425885e-01f,+1.78123376e+00f,-2.97754439e-01f,+1.12872727e+00f,
-1.77543584e+00f,+1.34108641e+00f,-1.23099993e+00f,-4.19612524e-01f,-7.99675816e-01f,
-1.67958542e+00f,+1.61852401e+00f,-5.19383290e-01f,+1.22789754e-01f,-2.35349364e-02f,
-1.47135543e+00f,-1.17418376e+00f,-1.69524476e+00f,+3.16867998e-02f,-9.53801793e-01f,
-5.71753564e-01f,-1.56773869e+00f,+1.15020736e+00f,-1.57366449e+00f,+1.94283529e+00f,
-1.29135534e+00f,+2.89620450e-01f,-1.82061866e+00f,+1.14846516e+00f,-1.24157621e+00f,
+1.11615914e-01f,+9.60310173e-01f,-1.40027406e+00f,+2.04348697e-01f,-1.13353117e+00f,
+1.03678420e+00f,+8.91660774e-01f,-1.29380386e+00f,+1.44786623e+00f,-1.92089960e+00f,
+1.44094799e+00f,+2.35615245e-01f,-3.87118112e-01f,+1.03498772e+00f,+8.67716007e-01f,
+1.94930470e+00f,-8.87659806e-01f,-1.98482531e+00f,+1.73561043e+00f,+1.43158842e+00f,
+9.15403510e-01f,+6.67551317e-02f,+8.27824981e-01f,+1.12211823e+00f,-5.00496226e-01f,
+1.08129010e+00f,+1.00249728e+00f,+4.52844846e-01f,-3.92536304e-01f,+7.89232077e-01f,
-1.98754857e+00f,+1.09958659e+00f,+1.58566641e+00f,-1.04273717e+00f,-1.51693126e+00f,
-1.11886405e+00f,-7.91613075e-01f,+1.53211403e+00f,+1.72665721e-01f,-8.53153402e-01f,
-1.44658124e+00f,-8.39422148e-01f,+4.55484359e-01f,-7.03445880e-01f,-1.70559273e-01f,
-2.23531572e-01f,+1.31254144e+00f,-2.94607383e-01f,-6.17204715e-01f,+6.99886419e-01f,
-1.11407178e+00f,-1.31016704e-01f,-7.40937251e-01f,+5.07422409e-01f,+1.50944190e+00f,
-2.09243999e-01f,+1.13782968e+00f,-1.72137198e-01f,+6.24917327e-01f,-1.47263610e+00f,
-2.68073972e-01f,+1.63724795e+00f,+4.21916004e-01f,+1.06709835e+00f,+1.88024324e-02f,
-7.77750069e-03f,+1.37159936e+00f,-1.72877226e+00f,+2.93089086e-01f,+1.77105030e+00f,
+7.14401927e-02f,-1.22213676e+00f,+1.39175757e+00f,-9.93443431e-01f,+8.02904146e-01f,
+1.61043762e-01f,+1.79534515e+00f,+4.97346810e-01f,+1.35191185e+00f,-1.96826850e+00f,
+1.95736022e+00f,-1.68914172e+00f,-7.11481946e-01f,+1.78460958e+00f,-1.96424359e+00f,
+1.29092002e+00f,+1.44484655e+00f,-2.40676743e-01f,-9.77019225e-01f,+1.21075808e+00f,
-8.85519823e-02f,-1.46264557e+00f,+1.71139597e+00f,+1.58387987e+00f,-3.38193999e-02f,
+1.42680999e+00f,-3.25687897e-01f,+7.33859601e-01f,-4.08037442e-01f,+2.29680698e-02f,
-1.24179319e+00f,+1.85995570e+00f,-8.23137247e-01f,-1.58616178e+00f,-1.42273840e+00f,
-1.94363082e+00f,+8.63782798e-01f,+2.57993281e-01f,+1.17831340e+00f,+2.83196931e-02f,
+1.16728416e+00f,+7.83056857e-01f,+1.11139391e+00f,-3.74068524e-01f,+5.91082533e-01f,
-1.28082281e+00f,-7.12720146e-01f,-1.30958152e+00f,-3.65451100e-01f,-1.03432501e+00f,
-3.72312023e-01f,+1.90088937e+00f,-7.18722697e-01f,+1.92996378e+00f, };
k2c_tensor test1_input_1_1_input = { &test1_input_1_1_input_array[0],3,784,{28,28, 1, 1, 1} };
float keras_dense_2_test1_array[10] = {
+1.61644709e-06f,+1.07285478e-08f,+3.77330408e-02f,+5.01512068e-06f,+2.82698147e-06f,
+3.05640299e-07f,+1.11865646e-08f,+2.98523673e-07f,+9.62253332e-01f,+3.52879329e-06f,
};
k2c_tensor keras_dense_2_test1 = { &keras_dense_2_test1_array[0],1,10,{10, 1, 1, 1, 1} };
float c_dense_2_test1_array[10] = { 0 };
k2c_tensor c_dense_2_test1 = { &c_dense_2_test1_array[0],1,10,{10, 1, 1, 1, 1} };
int main() {
    int fp_test1_input_1_1_input_array[784] = { 0 };
    k2c_tensor_int fp_test1_input_1_1_input = { &fp_test1_input_1_1_input_array[0],3,784,{28,28,1,1.0,1.0} };
    float_tensor_to_fixed(&test1_input_1_1_input, &fp_test1_input_1_1_input, 784);
    float errors[1];
    size_t num_tests = 1;
    size_t num_outputs = 1;
    simplenet_initialize();
    simplenet(&fp_test1_input_1_1_input, &c_dense_2_test1);

    errors[0] = maxabs(&keras_dense_2_test1, &c_dense_2_test1);
    float maxerror = errors[0];
    for (size_t i = 1; i < num_tests * num_outputs; i++) {
        if (errors[i] > maxerror) {
            maxerror = errors[i];
        }
    }
    printf("Max absolute error for 1 tests: %e \n", maxerror);
    simplenet_terminate();
    system("pause"); // Wait for user input before closing the console
    if (maxerror > 1e-05) {
        return 1;
    }
    return 0;
}

float maxabs(k2c_tensor* tensor1, k2c_tensor* tensor2) {

    float x = 0;

    float y = 0;

    for (size_t i = 0; i < tensor1->numel; i++) {

        y = fabsf(tensor1->array[i] - tensor2->array[i]);
        if (y > x) { x = y; }
    }
    return x;
}

